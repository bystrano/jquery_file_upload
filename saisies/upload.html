<input type="hidden" name="joindre_upload" value="oui" />
<input type="file" id="#ENV{nom}" name="#ENV{nom}[]" multiple
       data-url="#ENV{action}" >
<div id="progressbar"></div>

<script type="text/javascript">
$(function () {

    (function charger_form_upload () {
        var upload_form = $('\##ENV{nom}').parents('form').first(),
            progressbar = upload_form.find('#progressbar').progressbar({
                'value': false
            });

        upload_form.fileupload({
            add: function (e,data) {
                upload_form.find('\##ENV{nom}').animateLoading();
                data.submit();
            },
            done: function (e, data) {
                upload_form
                    .html(data.result)
                    .endLoading();
                charger_form_upload();
            },
            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                progressbar.progressbar('value', progress);
            }
        });
    })();
});
</script>
